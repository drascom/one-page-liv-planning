<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patient Record</title>
  <link rel="stylesheet" href="/static/css/styles.css" />
  <link rel="icon" type="image/svg+xml" href="/static/img/favicon.svg" />
</head>

<body class="patient-page new-patient-page app-shell">
  <div class="app-layout">
    <nav class="top-nav top-nav--subpage">
      <div class="top-nav__brand">
        <a class="top-nav__brand-link" href="/dashboard">
          <span class="top-nav__brand-icon" aria-hidden="true">‚ùñ</span>
          <span class="top-nav__brand-text">
            <span class="top-nav__brand-name">Liv Planner</span>
            <span class="top-nav__version" data-app-version>Version dev</span>
          </span>
          <span class="connection-indicator" id="connection-indicator" aria-hidden="true"></span>
        </a>
        <span class="top-nav__divider" aria-hidden="true">‚Ä¢</span>
        <span class="top-nav__section">Patient Record</span>
      </div>
      <form class="top-nav__search patient-search" id="patient-search-form" role="search" autocomplete="off">
        <label class="visually-hidden" for="patient-search">Search patients</label>
        <span class="search-icon" aria-hidden="true">üîç</span>
        <input id="patient-search" type="search" name="patientSearch" class="search-input"
          placeholder="Search by name or surname" enterkeyhint="search" />
        <button type="button" class="patient-search__clear" id="patient-search-clear" aria-label="Clear search"
          title="Clear search">
          √ó
        </button>
        <ul class="patient-search__results" id="patient-search-results" role="listbox"></ul>
      </form>
      <div class="top-nav__actions">
        <a class="nav-btn nav-btn--ghost" href="/schedule" aria-label="Schedule">
          <svg class="nav-btn__icon" aria-hidden="true" focusable="false">
            <use href="/static/img/nav-icons.svg#icon-schedule"></use>
          </svg>
          <span class="nav-btn__label">Schedule</span>
        </a>
        <a class="nav-btn nav-btn--ghost" href="/customers" data-admin-customers hidden aria-label="Customers">
          <svg class="nav-btn__icon" aria-hidden="true" focusable="false">
            <use href="/static/img/nav-icons.svg#icon-customers"></use>
          </svg>
          <span class="nav-btn__label">Customers</span>
        </a>
        <a class="nav-btn nav-btn--ghost" href="/settings" data-admin-link hidden aria-label="Settings">
          <svg class="nav-btn__icon" aria-hidden="true" focusable="false">
            <use href="/static/img/nav-icons.svg#icon-settings"></use>
          </svg>
          <span class="nav-btn__label">Settings</span>
        </a>
        <button type="button" class="nav-btn nav-btn--primary" data-logout-btn aria-label="Logout">
          <svg class="nav-btn__icon" aria-hidden="true" focusable="false">
            <use href="/static/img/nav-icons.svg#icon-logout"></use>
          </svg>
          <span class="nav-btn__label">Logout</span>
        </button>
      </div>
    </nav>


    <main class="main-content patient-content new-patient-layout">
      <section class="patient-grid two-column-section">
        <div class="patient-left-column patient-column">
          <section class="patient-details-card card patient-form-section patient-card">
            <header class="card-header patient-panel__header">
              <div>
                <p class="settings-section__eyebrow">Patient Details</p>
                <h2 id="patient-name">Patient Record</h2>
                <p id="patient-week" class="patient-week" aria-live="polite"></p>
                <p id="patient-address" class="patient-address" aria-live="polite"></p>
              </div>
            </header>
            <div class="patient-summary" id="patient-summary">
              <dl class="detail-list patient-summary__list">
                <div class="detail-row">
                  <dt>Name</dt>
                  <dd data-patient-summary="name">‚Äî</dd>
                </div>
                <div class="detail-row">
                  <dt>Email</dt>
                  <dd data-patient-summary="email">‚Äî</dd>
                </div>
                <div class="detail-row">
                  <dt>Phone</dt>
                  <dd>
                    <a data-patient-summary="phone_link" class="patient-summary__phone-link" href="tel:" rel="nofollow">‚Äî</a>
                  </dd>
                </div>
                <div class="detail-row">
                  <dt>Emergency Contact</dt>
                  <dd data-patient-summary="emergency_contact">‚Äî</dd>
                </div>
                <div class="detail-row">
                  <dt>Address</dt>
                  <dd data-patient-summary="address">‚Äî</dd>
                </div>
                <div class="detail-row">
                  <dt>DOB</dt>
                  <dd data-patient-summary="dob">‚Äî</dd>
                </div>
              </dl>
              <div class="patient-summary__actions">
                <button type="button" class="btn btn-secondary secondary-btn" id="patient-edit-btn">
                  Edit details
                </button>
              </div>
            </div>
            <form id="patient-form" class="patient-form form-layout" hidden aria-hidden="true">
              <div class="form-group">
                <label for="first-name">First Name</label>
                <input id="first-name" name="firstName" type="text" class="text-uppercase" required value="New"
                  placeholder="Enter first name" />
              </div>
              <div class="form-group">
                <label for="last-name">Last Name</label>
                <input id="last-name" name="lastName" type="text" class="text-uppercase" required value="Patient"
                  placeholder="Enter last name" />
              </div>
              <div class="form-group">
                <label for="dob">Date of Birth</label>
                <input id="dob" name="dob" type="date" placeholder="YYYY-MM-DD" />
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input id="email" name="email" type="email" required value="test@example.com"
                  placeholder="name@example.com" />
              </div>
              <div class="form-group">
                <label for="phone">Phone</label>
                <input id="phone" name="phone" type="tel" required value="+44 12345678" placeholder="+1 555 000 0000" />
              </div>
              <div class="form-group">
                <label for="emergency-contact-name">Emergency Contact Name</label>
                <input id="emergency-contact-name" name="emergencyContactName" type="text" placeholder="Name" />
              </div>
              <div class="form-group">
                <label for="emergency-contact-number">Emergency Contact Phone</label>
                <input id="emergency-contact-number" name="emergencyContactNumber" type="tel" placeholder="+44 7000 000000" />
              </div>
              <div class="form-group">
              <label for="address">Address</label>
              <input id="address" name="address" type="text" required value="fields" placeholder="Address" />
              </div>
              <div class="form-group" id="drive-folder-group" data-admin-only hidden>
                <label for="drive-folder-id">Drive Folder ID (admin)</label>
                <input id="drive-folder-id" name="driveFolderId" type="text" placeholder="Google Drive folder id"
                  autocomplete="off" />
              </div>
              <p id="patient-status" class="form-status" role="status"></p>
              <div class="card-actions">
                <button type="button" class="btn btn-secondary secondary-btn" id="patient-cancel-edit-btn">
                  Cancel
                </button>
                <button type="submit" class="btn btn-success primary-btn">Save Details</button>
                <button type="button" class="btn btn-danger danger-btn" id="delete-patient-btn" hidden>Delete
                  Patient</button>
              </div>
            </form>
          </section>

          <section class="patient-media-section patient-card card patient-documents-card">
            <header class="card-header patient-photo-card__header">
              <div>
                <p class="settings-section__eyebrow">Files</p>
              </div>
              <p class="upload-hint">PDF reports and ZIP bundles linked to this patient.</p>
            </header>
            <p class="document-empty" id="documents-empty">No PDF or ZIP files available.</p>
            <div class="document-grid" id="documents-list"></div>
          </section>

          <section class="patient-media-section patient-photo-card patient-card card">
            <header class="card-header patient-photo-card__header">
              <div>
                <p class="settings-section__eyebrow">Photos</p>
                <h2>Upload &amp; Gallery</h2>
              </div>
            </header>
            <div class="drop-zone" id="drop-zone">
              <input id="photo-input" type="file" multiple accept="image/*" hidden />
              <button type="button" class="btn btn-secondary secondary-btn" id="browse-button">Upload files</button>
            </div>
            <ul class="upload-list" id="upload-list"></ul>
            <p class="upload-status" id="upload-status"></p>
            <div class="photo-gallery-section">
              <h3>Patient Photos</h3>
              <p class="photo-empty" id="photo-empty">No photos uploaded yet.</p>
              <div class="photo-gallery" id="photo-gallery"></div>
            </div>
            <div class="photo-gallery-section">
              <h3>Patient Videos</h3>
              <p class="photo-empty" id="video-empty">No videos uploaded yet.</p>
              <div class="photo-gallery" id="video-gallery"></div>
            </div>
          </section>
        </div>

        <div class="patient-right-column patient-surgery-section">
          <section class="card patient-card procedures-card">
            <header class="card-header patient-panel__header">
              <div>
                <p class="settings-section__eyebrow">Procedures</p>
                <h2>Procedures</h2>
              </div>
              <div class="card-actions">
                <button type="button" class="btn btn-add secondary-btn" id="add-procedure-btn" hidden>Add</button>
                <button type="button" class="btn btn-danger danger-btn" id="cancel-procedure-btn" hidden>Delete
                  Procedure</button>
              </div>
            </header>
            <p id="procedures-status" class="form-status" role="status"></p>
            <div id="patient-bookings-list" class="tab-menu patient-bookings-sidebar" role="tablist"
              aria-label="Procedures list"></div>

            <form id="procedure-form" class="procedure-form">
              <div class="card-actions procedures-card__actions procedures-card__actions--top">
                <button type="submit" class="btn btn-success primary-btn">Save Procedure</button>
              </div>

              <section class="procedure-details">
                <h3>Surgery Details</h3>
                <div class="form-layout">
                  <div class="form-group">
                    <label for="procedure-date">Procedure Date</label>
                    <input id="procedure-date" name="procedureDate" type="date" value="2025-11-01"
                      placeholder="YYYY-MM-DD" />
                  </div>
                  <div class="form-group">
                    <label for="procedure-time">Procedure Time</label>
                    <select id="procedure-time" name="procedureTime"></select>
                  </div>
                  <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" name="status"></select>
                  </div>
                  <div class="form-group">
                    <label for="procedure-type">Procedure Type</label>
                    <select id="procedure-type" name="procedureType"></select>
                  </div>
                  <div class="form-group">
                    <label for="package-type">Package Type</label>
                    <select id="package-type" name="packageType"></select>
                  </div>
                  <div class="form-group">
                    <label for="grafts">Grafts</label>
                    <input id="grafts" name="grafts" type="number" inputmode="numeric" step="1" min="0" value="2500"
                      placeholder="e.g. 2500" />
                  </div>
                  <div class="form-group">
                    <label for="payment">Payment</label>
                    <select id="payment" name="payment"></select>
                  </div>
                  <div class="form-group">
                    <label for="outstanding-balance">Outstanding Balance</label>
                    <input id="outstanding-balance" name="outstandingBalance" type="number" inputmode="decimal" step="0.01"
                      min="0" placeholder="0.00" />
                  </div>
                  <div class="form-group">
                    <label for="agency">Agency</label>
                    <select id="agency" name="agency"></select>
                  </div>
                  <div class="form-group" id="procedure-source-group" hidden>
                    <label>Source (admin)</label>
                    <span id="procedure-source-text" class="form-static-value">‚Äî</span>
                  </div>
                </div>
                <p id="procedure-form-status" class="form-status" role="status"></p>
              </section>

              <section class="forms-consents">
                <h3>Forms &amp; Consents</h3>
                <div class="form-layout">
                   <div class="form-group">
                    <label>Consents</label>
                    <div id="consents-checklist" class="checklist form-checklist" role="group"
                      aria-label="Consents checklist"></div>
                    <select id="consents" name="consents" multiple hidden></select>
                    <h4>Consultations</h4>
                    <div id="consultations-checklist" class="checklist form-checklist" role="group" aria-label="Consultations checklist"></div>
                    <select id="consultation" name="consultation" multiple hidden></select>
                  </div> 
                  <div class="form-group">
                    <label>Forms</label>
                    <div id="forms-checklist" class="checklist form-checklist" role="group" aria-label="Forms checklist">
                    </div>
                    <select id="forms" name="forms" multiple hidden></select>
                  </div>
                </div>
              </section>
            

              <section class="preop-section">
                <h3>Pre-op Checklist</h3>
                <div class="form-layout">
                  <div class="form-group">
                    <label for="preop-prp-session">Q: Is the patient having a session of PRP on the day of surgery?</label>
                    <textarea
                      id="preop-prp-session"
                      name="preopPrpSession"
                      rows="2"
                      placeholder="Yes / No / Unknown"
                    ></textarea>
                    <p class="form-hint">Share the confirmed answer so automation keeps notes separate.</p>
                  </div>
                  <div class="form-group">
                    <label for="preop-medical-alerts">Q: Are there any medications or conditions the team should be aware of?</label>
                    <textarea
                      id="preop-medical-alerts"
                      name="preopMedicalAlerts"
                      rows="2"
                      placeholder="Provide summary or 'None'"
                    ></textarea>
                    <p class="form-hint">Use this field for the permanent checklist answer instead of procedure notes.</p>
                  </div>
                </div>
              </section>

              <section class="notes-section">
                <h3>Procedure Notes</h3>
                <div class="notes-body">
                  <div class="form-group">
                    <label for="procedure-note-input">Add Note</label>
                    <div class="input-with-button">
                      <input id="procedure-note-input" name="procedureNoteInput" type="text"
                        placeholder="Write a note and press Enter" class="text-input" />
                    </div>
                  </div>
                  <ul id="procedure-notes-list" class="todo-list"></ul>
                  <p class="form-hint">Only your own notes can be deleted.</p>
                </div>
              </section>

              <div class="card-actions procedures-card__actions">
                <button type="submit" class="btn btn-success primary-btn">Save Procedure</button>
              </div>
            </form>
          </section>
        </div>
      </section>
      <p id="form-status" class="form-status" role="status"></p>

      <!-- Admin Debug Section -->
      <section id="admin-debug" class="admin-debug card" hidden style="margin-top: 2rem; border: 1px solid red;">
        <header class="card-header">
          <h3>Admin Debug</h3>
        </header>
        <div style="padding: 1rem;">
          <p><strong>Drive Folder ID:</strong> <span id="debug-drive-folder"></span></p>
          <p><strong>Drive Files:</strong> <span id="debug-drive-files"></span></p>
          <p><strong>Parsed IDs:</strong> <span id="debug-drive-count"></span></p>
          <p><strong>Last API Error:</strong> <span id="debug-api-error" style="color: red;">None</span></p>
          <button type="button" class="btn btn-secondary" id="debug-test-drive">Test First Image Fetch</button>
          <pre id="debug-console"
            style="background: #eee; padding: 10px; margin-top: 10px; font-size: 12px; overflow: auto; max-height: 200px;"></pre>
        </div>
      </section>
    </main>

    <div class="photo-viewer" id="photo-viewer" hidden>
      <button type="button" class="photo-viewer__close" id="photo-viewer-close" aria-label="Close viewer">
        √ó
      </button>
      <button type="button" class="photo-viewer__nav photo-viewer__nav--prev" id="photo-viewer-prev"
        aria-label="Previous photo">
        ‚Üê
      </button>
      <img id="photo-viewer-image" alt="Patient photo" />
      <p id="photo-viewer-caption" class="photo-viewer__caption"></p>
      <button type="button" class="photo-viewer__nav photo-viewer__nav--next" id="photo-viewer-next"
        aria-label="Next photo">
        ‚Üí
      </button>
      <div class="photo-viewer__actions">
        <a id="photo-viewer-download" class="photo-viewer__action photo-viewer__action--download" href="#"
          hidden download rel="noreferrer noopener">Download</a>
        <button type="button" class="photo-viewer__action photo-viewer__action--delete" id="photo-viewer-delete"
          hidden>Delete photo</button>
      </div>
    </div>
  </div>

  <script src="/app-config.js"></script>
  <script src="/static/js/nav-connection.js" type="module"></script>
  <script src="/static/js/nav-search.js" type="module"></script>
  <script src="/static/js/patient.js" type="module"></script>
</body>

</html>
